---
date created: 星期二, 四月 9日 2024, 8:58:47 晚上
date modified: 星期二, 四月 16日 2024, 10:36:57 上午
tags: 
---

# 3c2-线程的实现

线程主要有三种实现方案：
- 用户线程
- 内核线程
- 轻量级进程

这三种实现方案的出现也与操作系统的发展相关

## 用户线程

早期的操作系统还没出现线程，是程序员直接在应用程序中自行实现线程管理，因此被称为用户级线程。后来也发展出了一些用户级线程库，方便应用程序实现使用线程。

### 优点

- 用户级线程其实是应用程序本身的行为，用户级线程的创建、调度和销毁都是在用户空间完成的，不涉及操作系统内核，避免了内核态和用户态切换的开销。

### 缺点

操作系统完全不知道用户级线程的存在，因此仍然以进程为进本单位进行调度，进而带来以下问题：
- 无法充分利用多核CPU
- 如果某个线程发生了阻塞，会导致整个进程阻塞。

## 内核线程

操作系统后续提供了对线程的直接支持，即内核线程，由内核来管理线程。

### 优点

- 支持多核
- 单线程阻塞，不影响同进程下其他线程的运行

### 缺点

- 内核线程的创建、调度、销毁都需要操作系统进行系统调用，随后发生用户态和内核态的切换，整体的代价比较大，和调度进程差不多。

## 轻量级进程（Light-weight Process，LWP）

由于操作系统不知道用户级线程的存在，因此无法为其分配CPU资源，也无法产生中断唤醒对应的用户级线程，内核级线程虽然没有上述问题，但是创建、调度、销毁都需要内核的参与导致其性能不占优势。

为了克服用户级线程和内核线程各自的局限性，想要给用户级线程添加被操作系统认得的能力，想要解决内核线程进行创建、销毁的高开销，最终的产物就是轻量级进程。

轻量级进程在用户空间进行创建，创建时操作系统内核会为其分配一个或多个对应的内核线程。