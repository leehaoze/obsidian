---
date created: 星期三, 五月 29日 2024, 8:08:54 晚上
date modified: 星期三, 五月 29日 2024, 8:34:35 晚上
source: https://www.xiaolincoding.com/os/4_process/process_commu.html#%E7%AE%A1%E9%81%93
tags: 
---

# 管道

## 匿名管道

Linux中的`|`就是管道，这种是匿名管道，用完了就抛弃了。

## 命名管道

还可以通过`mkfifo`创建命名管道，命名管道也叫`FIFO`，因为数据是先进先出的。

```shell
mkfifo pipe
ehco "hello world" > pipe // 会hang在这里
cat < pipe // 新启动一个shell读取 两个都会退出
```

## 原理

所谓管道，是一种特殊的文件，其实就是在内核的内存空间中放置了一个特殊的文件。通过系统调用创建管道时，会得到一个写描述符，一个读描述符。

子进程通过fork，获得了父进程持有的文件描述符，其中就包含这个匿名管道的描述符，这样两个进程可以通过读写描述符来操作管道文件。

不过一般为了不造成混乱，会保持该管道时单向的，即父进程关闭读取描述符，子进程关闭写入描述符。如果需要双向通信，则创建两个管道。

再shell中使用匿名管道，其实是以shell为父进程，分别创建了N个子进程，将读写描述符传递给子进程。

![BSehjA](https://image.leehaoze.com/uPic/BSehjA.png)

不过命名管道会在文件系统中创建一个设备文件，不相干的两个进程可以通过文件系统的设备文件访问管道。